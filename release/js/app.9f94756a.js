(function(){"use strict";var e={573:function(e,t,o){var n=o(9242),l=o(3396),c=o(7139),s=o(4870),i=o(9999),a=o.n(i);const r=new Map;function u(e=null){let t=!1;while(!t){const o=("0000"+(Math.random()*Math.pow(36,4)|0).toString(36)).slice(-4);if(e||(e=r),!e.get(o))return t=!0,e.set(o,!0),o}}class d{constructor(){this.connection={host:"c4584ed806fd4a70bc09a60417504f7f.s1.eu.hivemq.cloud",port:8884,endpoint:"/mqtt",clean:!0,connectTimeout:4e3,reconnectPeriod:10,clientId:"client-id-"+u()+"-"+u(),username:"testuser",password:"password"},this.subscription={topic:"TELEMETRY",qos:0},this.receivedMessages="",this.qosList=[{label:0,value:0},{label:1,value:1},{label:2,value:2}],this.client={connected:!1},this.subscribeSuccess=!1,this.data=new Map}onConnectionLost(){console.log("onConnectionLost")}createConnection(e,t){const{host:o,port:n,endpoint:l,...c}=this.connection,s=`wss://${o}:${n}${l}`;try{this.client=a().connect(s,c),a().onConnectionLost=this.onConnectionLost}catch(i){console.log("mqtt.connect error",i)}this.client.on("connect",(()=>{"function"==typeof t&&t("orange"),console.log("Connection succeeded!")})),this.client.on("onConnectionLost",(()=>{console.log("Connection lost!!")})),this.client.on("error",(e=>{console.log("Connection failed",e)})),this.client.on("message",((o,n)=>{let l=(new TextDecoder).decode(n);"function"==typeof e&&e(l),"function"==typeof t&&t("green")}))}doSubscribe(){const{topic:e,qos:t}=this.subscription;this.client.subscribe(e,t,((e,t)=>{e?console.log("Subscribe to topics error",e):(this.subscribeSuccess=!0,console.log("Subscribe to topics res",t))}))}doUnSubscribe(){const{topic:e}=this.subscription;this.client.unsubscribe(e,(e=>{e&&console.log("Unsubscribe error",e)}))}doPublish(){const{topic:e,qos:t,payload:o}=this.publish;this.client.publish(e,o,t,(e=>{e&&console.log("Publish error",e)}))}destroyConnection(){if(this.client.connected)try{this.client.end(),this.client={connected:!1},console.log("Successfully disconnected!")}catch(e){console.log("Disconnect failed",e.toString())}}}const p=new d;var f=p;o(6699);function v(e,t){var o=0,n=e.length;while(o<n&&e[o]===t)++o;while(n>o&&e[n-1]===t)--n;return o>0||n<e.length?e.substring(o,n):e}class h{constructor(){}static extract(e,t="events"){const o=v(e,'"').split(",");if("events"==t&&o[0]&&o[0]==t){const e=o.some((e=>e.includes("eventName=TEMP_C")));if(e){const e={};return o.forEach((t=>{t.includes("tagId")&&(e.tag=t.replace("tagId=","")),t.includes("eventName")&&(e.name=t.replace("eventName=","")),t.includes("eventValue")&&(e.value=Number.parseFloat(t.replace("eventValue=","")).toFixed(2),e.raw=t.replace("eventValue=","")),t.includes("timestamp")&&(e.timestamp=parseInt(t.replace("timestamp=","")))})),e}}return null}static coordinates(e){const t=new Map;if(!e)return t;const o=e.replace(/\r\n/g,"\n").split("\n");return o.forEach((e=>{const o=e.split(",");if("ID"!=o[0]){const e=o[0].replace("tagId=",""),n=o[1],l=o[2];t.set(e,{x:n,y:l})}})),t}}class b{constructor(){this.id=u(),this.x=0,this.y=0,this.created=Date.now(),this.data={tag:"",name:"",value:"",timestamp:""}}inject(e){e&&(this.x=e.x?e.x:0,this.y=e.y?e.y:0)}}class m extends b{constructor(){super(),this.type="wavelet",this.color="rgb(255,255,255)"}}function g(e){const t=20,o=30;let n=370,l=250,c=n-l,s=o-t,i=o-e,a=c/s;return 360-(i*a-(n-360))}function y(e){const t=g(e);let o=100,n=50;t>280&&t<325&&(n=50,o=30),o/=100,n/=100;const l=e=>(e+t/30)%12,c=o*Math.min(n,1-n),s=e=>n-c*Math.max(-1,Math.min(l(e)-3,Math.min(9-l(e),1)));return[255*s(0),255*s(8),255*s(4)]}function w(e){const t=new Date(e),o=t.getHours(),n=t.getMinutes(),l=t.getSeconds();return(o<10?"0"+o:o)+":"+(n<10?"0"+n:n)+":"+(l<10?"0"+l:l)+"."+t.getMilliseconds()}const _=e=>((0,l.dD)("data-v-24beb6e4"),e=e(),(0,l.Cn)(),e),x={class:"me-3"},k=_((()=>(0,l._)("span",{class:"fw-lighter opacity-75"},"X:",-1))),M=_((()=>(0,l._)("span",{class:"fw-lighter opacity-75"},"Y:",-1))),C={class:"ui-wrapper mb-3"},j={class:"mb-3"},S={for:"map-file-upload",class:"form-label small"},D=_((()=>(0,l._)("span",{class:"text-white-50"},"Upload map CSV",-1))),T=(0,l.Uk)(" ("),H=(0,l.Uk)(")"),O=_((()=>(0,l._)("hr",null,null,-1))),U={class:"form-check mb-3"},q=_((()=>(0,l._)("label",{class:"form-check-label",for:"grid-checkbox",style:{color:"white"}}," Grid mode ",-1))),E={class:"form-check mb-3"},V=_((()=>(0,l._)("label",{class:"form-check-label",for:"crosshair-checkbox",style:{color:"white"}}," Crosshair cursor ",-1))),P=_((()=>(0,l._)("hr",null,null,-1))),I={class:"form-check mb-3"},L=_((()=>(0,l._)("label",{class:"form-check-label",for:"sim-checkbox",style:{color:"white"}}," Enable simulation ",-1))),$=_((()=>(0,l._)("hr",null,null,-1))),z={class:"form-check mb-3"},Y=_((()=>(0,l._)("label",{class:"form-check-label",for:"color-wavelets-checkbox",style:{color:"white"}}," Color wavelets ",-1))),F=_((()=>(0,l._)("hr",null,null,-1)));var N={__name:"DisplayComponent",setup(e){const t=(0,s.iH)(new Map),o=(0,s.iH)(new Map),i=(0,s.iH)(!1);function a(){f.createConnection(u,_),f.doSubscribe()}function r(){f.doUnSubscribe(),f.destroyConnection()}function u(e){if(!0===i.value)return!1;const n=new m;if("string"==typeof e){const l=h.extract(e);if(l){n.data=l;const e=y(n.data.value);n.color=`rgb(${e[0]},${e[1]},${e[2]})`}const c=n.data.timestamp,s=o.value.get(n.data.tag);s?(console.log("Tag "+n.data.tag+" ("+c+" / "+w(c)+") is in map. Render."),n.inject(s),t.value.set(n.data.tag,n)):console.log("Tag "+n.data.tag+" ("+c+" / "+w(c)+") is not in map!")}}function d(e){let t=e.target;const n=new FileReader;n.onload=function(){o.value=h.coordinates(n.result),console.log("Uploaded CSV:"),console.log(n.result.substring(0,200))},n.readAsText(t.files[0])}const p=(0,s.iH)(!1);function v(){!0===p.value?(r(),g.value="green",R()):(g.value="red",a())}(0,l.bv)((()=>{!0===p.value?(g.value="green",R()):(g.value="red",a()),X(),o.value=h.coordinates()}));const b=(0,s.iH)(!0),g=(0,s.iH)("red");function _(e){b.value=!b.value,g.value=e}function N(){const e=4e3,t=5026,o=15,n=27,l="(01)00850027865010(21)00oeT"+Math.floor(Math.random()*(t-e)+e).toString(),c=(Math.random()*(n-o)+o).toFixed(4);let s="events,tagId="+l+",eventName=TEMP_C,eventValue="+c+",timestamp="+Date.now();return s}function R(){if(!1===p.value)return!1;b.value=!b.value;const e=N();u(e),setTimeout(R,Math.floor(10*Math.random())+1)}function X(){const e=9,o=Date.now();t.value.forEach((n=>{const l=Math.floor((o-n.created)/1e3);l>=e&&(console.log("Lifetime exceeded "+e+"s for #"+n.id),t.value.delete(n.data.tag))})),setTimeout(X,500)}const A=(0,s.iH)(!1),K=(0,s.iH)(0),G=(0,s.iH)(0),Z=(0,s.qj)({position:{x:0,y:0}});function B(e){i.value&&(K.value=e.clientX,G.value=e.clientY,Z.position.x=e.clientX,Z.position.y=e.clientY)}const J=(0,s.iH)(!1);return(e,s)=>((0,l.wg)(),(0,l.iD)("div",{class:"display",onMousemove:B,style:(0,c.j5)((i.value&&J.value?"cursor: crosshair;":"")+(i.value?"box-shadow: inset 0 0 0 2px wheat;":""))},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.value,(([e,t])=>((0,l.wg)(),(0,l.iD)("div",{key:e,class:(0,c.C_)("wavelet t-"+t.data.value),style:(0,c.j5)("left:"+t.x+"px; top:"+t.y+"px;")},[(0,l._)("span",{class:"wavelet__value",style:(0,c.j5)(`color: ${t.color}`)},(0,c.zw)(t.data.value?t.data.value:"-")+"Â°",5),A.value?((0,l.wg)(),(0,l.iD)("div",{key:0,class:"wavelet-coloring",style:(0,c.j5)(`background-color: ${t.color}`)},null,4)):(0,l.kq)("",!0)],6)))),128)),i.value?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.value,(([e,t])=>((0,l.wg)(),(0,l.iD)("div",{key:e,class:"wavelet wavelet_eternal",style:(0,c.j5)("left:"+t.x+"px; top:"+t.y+"px;")},null,4)))),128)),(0,l._)("div",{class:"mouse-coordinates-tooltip",style:(0,c.j5)("top: "+Z.position.y+"px; left: "+Z.position.x+"px;")},[(0,l._)("span",x,[k,(0,l.Uk)(" "+(0,c.zw)(K.value),1)]),(0,l._)("span",null,[M,(0,l.Uk)(" "+(0,c.zw)(G.value),1)])],4)],64)):(0,l.kq)("",!0),(0,l._)("div",C,[(0,l._)("div",{class:"ui-container-toggle",style:(0,c.j5)(0==o.value.size?"display: block !important;":"")},[(0,l._)("div",{class:(0,c.C_)(["connection-status mb-3",g.value]),style:(0,c.j5)("background-color:"+g.value+"; opacity: "+(b.value?1:.3)+";")},null,6),(0,l._)("div",j,[(0,l._)("label",S,[D,T,(0,l._)("span",{style:(0,c.j5)(0==o.value.size?"color: red":"color: green")},(0,c.zw)(o.value.size)+" ids loaded",5),H]),(0,l._)("input",{class:"form-control form-control-sm",id:"map-file-upload",type:"file",onChange:d},null,32)]),O,(0,l._)("div",U,[(0,l.wy)((0,l._)("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=e=>i.value=e),id:"grid-checkbox"},null,512),[[n.e8,i.value]]),q]),(0,l._)("div",E,[(0,l.wy)((0,l._)("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=e=>J.value=e),id:"crosshair-checkbox"},null,512),[[n.e8,J.value]]),V]),P,(0,l._)("div",I,[(0,l.wy)((0,l._)("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=e=>p.value=e),id:"sim-checkbox",onChange:v},null,544),[[n.e8,p.value]]),L]),$,(0,l._)("div",z,[(0,l.wy)((0,l._)("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=e=>A.value=e),id:"color-wavelets-checkbox"},null,512),[[n.e8,A.value]]),Y]),F],4)])],36))}},R=o(89);const X=(0,R.Z)(N,[["__scopeId","data-v-24beb6e4"]]);var A=X,K={__name:"App",setup(e){return(e,t)=>((0,l.wg)(),(0,l.j4)(A))}};const G=K;var Z=G;o(8937);(0,n.ri)(Z).mount("#app")}},t={};function o(n){var l=t[n];if(void 0!==l)return l.exports;var c=t[n]={exports:{}};return e[n](c,c.exports,o),c.exports}o.m=e,function(){var e=[];o.O=function(t,n,l,c){if(!n){var s=1/0;for(u=0;u<e.length;u++){n=e[u][0],l=e[u][1],c=e[u][2];for(var i=!0,a=0;a<n.length;a++)(!1&c||s>=c)&&Object.keys(o.O).every((function(e){return o.O[e](n[a])}))?n.splice(a--,1):(i=!1,c<s&&(s=c));if(i){e.splice(u--,1);var r=l();void 0!==r&&(t=r)}}return t}c=c||0;for(var u=e.length;u>0&&e[u-1][2]>c;u--)e[u]=e[u-1];e[u]=[n,l,c]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,n){var l,c,s=n[0],i=n[1],a=n[2],r=0;if(s.some((function(t){return 0!==e[t]}))){for(l in i)o.o(i,l)&&(o.m[l]=i[l]);if(a)var u=a(o)}for(t&&t(n);r<s.length;r++)c=s[r],o.o(e,c)&&e[c]&&e[c][0](),e[c]=0;return o.O(u)},n=self["webpackChunkwavelets"]=self["webpackChunkwavelets"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=o.O(void 0,[998],(function(){return o(573)}));n=o.O(n)})();
//# sourceMappingURL=app.9f94756a.js.map