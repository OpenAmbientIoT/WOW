(function(){"use strict";var e={2483:function(e,t,o){var l=o(9242),n=o(3396),c=o(7139),s=o(4870),a=o(9999),i=o.n(a);const r=new Map;function u(e=null){let t=!1;while(!t){const o=("0000"+(Math.random()*Math.pow(36,4)|0).toString(36)).slice(-4);if(e||(e=r),!e.get(o))return t=!0,e.set(o,!0),o}}class d{constructor(){this.connection={host:"c4584ed806fd4a70bc09a60417504f7f.s1.eu.hivemq.cloud",port:8884,endpoint:"/mqtt",clean:!0,connectTimeout:4e3,reconnectPeriod:10,clientId:"client-id-"+u()+"-"+u(),username:"testuser",password:"password"},this.subscription={topic:"TELEMETRY",qos:0},this.receivedMessages="",this.qosList=[{label:0,value:0},{label:1,value:1},{label:2,value:2}],this.client={connected:!1},this.subscribeSuccess=!1,this.data=new Map}onConnectionLost(){console.log("onConnectionLost")}createConnection(e,t){const{host:o,port:l,endpoint:n,...c}=this.connection,s=`wss://${o}:${l}${n}`;try{this.client=i().connect(s,c),i().onConnectionLost=this.onConnectionLost}catch(a){console.log("mqtt.connect error",a)}this.client.on("connect",(()=>{"function"==typeof t&&t("orange"),console.log("Connection succeeded!")})),this.client.on("onConnectionLost",(()=>{console.log("Connection lost!!")})),this.client.on("error",(e=>{console.log("Connection failed",e)})),this.client.on("message",((o,l)=>{let n=(new TextDecoder).decode(l);"function"==typeof e&&e(n),"function"==typeof t&&t("green")}))}doSubscribe(){const{topic:e,qos:t}=this.subscription;this.client.subscribe(e,t,((e,t)=>{e?console.log("Subscribe to topics error",e):(this.subscribeSuccess=!0,console.log("Subscribe to topics res",t))}))}doUnSubscribe(){const{topic:e}=this.subscription;this.client.unsubscribe(e,(e=>{e&&console.log("Unsubscribe error",e)}))}doPublish(){const{topic:e,qos:t,payload:o}=this.publish;this.client.publish(e,o,t,(e=>{e&&console.log("Publish error",e)}))}destroyConnection(){if(this.client.connected)try{this.client.end(),this.client={connected:!1},console.log("Successfully disconnected!")}catch(e){console.log("Disconnect failed",e.toString())}}}const v=new d;var p=v;o(6699);function f(e,t){var o=0,l=e.length;while(o<l&&e[o]===t)++o;while(l>o&&e[l-1]===t)--l;return o>0||l<e.length?e.substring(o,l):e}class h{constructor(){}static extract(e,t="events"){const o=f(e,'"').split(",");if("events"==t&&o[0]&&o[0]==t){const e=o.some((e=>e.includes("eventName=TEMP_C")));if(e){const e={};return o.forEach((t=>{t.includes("tagId")&&(e.tag=t.replace("tagId=","")),t.includes("eventName")&&(e.name=t.replace("eventName=","")),t.includes("eventValue")&&(e.value=Number.parseFloat(t.replace("eventValue=","")).toFixed(2),e.raw=t.replace("eventValue=","")),t.includes("timestamp")&&(e.timestamp=t.replace("timestamp=",""))})),e}}return null}static coordinates(e){const t=new Map;if(!e)return t;const o=e.replace(/\r\n/g,"\n").split("\n");return o.forEach((e=>{const o=e.split(",");if("ID"!=o[0]){const e=o[0].replace("tagId=",""),l=o[1],n=o[2];t.set(e,{x:l,y:n})}})),t}}class b{constructor(){this.id=u(),this.x=0,this.y=0,this.created=Date.now(),this.data={tag:"",name:"",value:"",timestamp:""}}inject(e){e&&(this.x=e.x?e.x:0,this.y=e.y?e.y:0)}}class m extends b{constructor(){super(),this.type="wavelet",this.color="rgb(255,255,255)"}}function g(e){const t=20,o=30;let l=370,n=250,c=l-n,s=o-t,a=o-e,i=c/s;return 360-(a*i-(l-360))}function y(e){const t=g(e);let o=100,l=50;t>280&&t<325&&(l=50,o=30),o/=100,l/=100;const n=e=>(e+t/30)%12,c=o*Math.min(l,1-l),s=e=>l-c*Math.max(-1,Math.min(n(e)-3,Math.min(9-n(e),1)));return[255*s(0),255*s(8),255*s(4)]}const _=e=>((0,n.dD)("data-v-6ddc1625"),e=e(),(0,n.Cn)(),e),w={class:"display"},k={key:1,class:"circles"},x={key:0,class:"circles"},C=(0,n.uE)('<div class="circle_pulse" data-v-6ddc1625></div><div class="circle_pulse" data-v-6ddc1625></div><div class="circle_pulse" data-v-6ddc1625></div><div class="circle_pulse" data-v-6ddc1625></div><div class="circle_pulse" data-v-6ddc1625></div><div class="circle_pulse" data-v-6ddc1625></div><div class="circle_pulse" data-v-6ddc1625></div><div class="circle_pulse" data-v-6ddc1625></div>',8),j=[C],M={class:"ui-wrapper mb-3"},S={class:"mb-3"},T={for:"map-file-upload",class:"form-label small"},D=_((()=>(0,n._)("span",{class:"text-white-50"},"Upload map CSV",-1))),$=(0,n.Uk)(" ("),O=(0,n.Uk)(")"),U={class:"form-check mb-3"},q=_((()=>(0,n._)("label",{class:"form-check-label",for:"grid-checkbox",style:{color:"white"}}," Grid mode ",-1))),E={class:"form-check mb-3"},H=_((()=>(0,n._)("label",{class:"form-check-label",for:"sim-checkbox",style:{color:"white"}}," Enable simulation ",-1))),V={class:"form-check mb-3"},P=_((()=>(0,n._)("label",{class:"form-check-label",for:"color-wavelets-checkbox",style:{color:"white"}}," Color wavelets ",-1))),L=_((()=>(0,n._)("hr",null,null,-1))),I={class:"form-check mb-3"},z=_((()=>(0,n._)("label",{class:"form-check-label",for:"tr-checkbox",style:{color:"white"}},[(0,n.Uk)(" Transparent "),(0,n._)("sup",{class:"text-warning fw-lighter"},"higher load")],-1)));var F={__name:"DisplayComponent",setup(e){const t=(0,s.iH)(new Map),o=(0,s.iH)(new Map),a=(0,s.iH)(!1),i=(0,s.iH)(!1);function r(){p.createConnection(d,C),p.doSubscribe()}function u(){p.doUnSubscribe(),p.destroyConnection()}function d(e){if(!0===a.value)return!1;const l=new m;if("string"==typeof e){const n=h.extract(e);if(n){l.data=n;const e=y(l.data.value);l.color=`rgb(${e[0]},${e[1]},${e[2]})`}const c=o.value.get(l.data.tag);c?(console.log("Tag "+l.data.tag+" is in map. Render."),l.inject(c),t.value.set(l.data.tag,l)):console.log("Tag "+l.data.tag+" is not in map!")}}function v(e){let t=e.target;const l=new FileReader;l.onload=function(){o.value=h.coordinates(l.result),console.log("Uploaded CSV:"),console.log(l.result.substring(0,200))},l.readAsText(t.files[0])}const f=(0,s.iH)(!1);function b(){!0===f.value?(u(),_.value="green",N()):(_.value="red",r())}(0,n.bv)((()=>{!0===f.value?(_.value="green",N()):(_.value="red",r()),R(),o.value=h.coordinates()}));const g=(0,s.iH)(!0),_=(0,s.iH)("red");function C(e){g.value=!g.value,_.value=e}function F(){const e=4e3,t=5026,o=15,l=27,n="(01)00850027865010(21)00oeT"+Math.floor(Math.random()*(t-e)+e).toString(),c=(Math.random()*(l-o)+o).toFixed(4);let s="events,tagId="+n+",eventName=TEMP_C,eventValue="+c+",timestamp="+Date.now();return s}function N(){if(!1===f.value)return!1;g.value=!g.value;const e=F();d(e),setTimeout(N,Math.floor(10*Math.random())+1)}function R(){const e=9,o=Date.now();t.value.forEach((l=>{const n=Math.floor((o-l.created)/1e3);n>=e&&(console.log("Lifetime exceeded "+e+"s for #"+l.id),t.value.delete(l.data.tag))})),setTimeout(R,500)}const Y=(0,s.iH)(!1);return(e,s)=>((0,n.wg)(),(0,n.iD)("div",w,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.value,(([e,t])=>((0,n.wg)(),(0,n.iD)("div",{key:e,class:(0,c.C_)((i.value?"trwavelet":"wavelet")+" t-"+t.data.value),style:(0,c.j5)("left:"+t.x+"px; top:"+t.y+"px;")},[(0,n._)("span",{class:(0,c.C_)(i.value?"trwavelet__value":"wavelet__value"),style:(0,c.j5)(`color: ${t.color}`)},(0,c.zw)(t.data.value?t.data.value:"-")+"Â°",7),!i.value&&Y.value?((0,n.wg)(),(0,n.iD)("div",{key:0,class:"wavelet-coloring",style:(0,c.j5)(`background-color: ${t.color}`)},null,4)):(0,n.kq)("",!0),i.value?((0,n.wg)(),(0,n.iD)("div",k,[(0,n._)("div",{class:"circle_pulse",style:(0,c.j5)(Y.value?`border-color: ${t.color}`:"")},null,4),(0,n._)("div",{class:"circle_pulse",style:(0,c.j5)(Y.value?`border-color: ${t.color}`:"")},null,4),(0,n._)("div",{class:"circle_pulse",style:(0,c.j5)(Y.value?`border-color: ${t.color}`:"")},null,4),(0,n._)("div",{class:"circle_pulse",style:(0,c.j5)(Y.value?`border-color: ${t.color}`:"")},null,4),(0,n._)("div",{class:"circle_pulse",style:(0,c.j5)(Y.value?`border-color: ${t.color}`:"")},null,4),(0,n._)("div",{class:"circle_pulse",style:(0,c.j5)(Y.value?`border-color: ${t.color}`:"")},null,4),(0,n._)("div",{class:"circle_pulse",style:(0,c.j5)(Y.value?`border-color: ${t.color}`:"")},null,4),(0,n._)("div",{class:"circle_pulse",style:(0,c.j5)(Y.value?`border-color: ${t.color}`:"")},null,4)])):(0,n.kq)("",!0)],6)))),128)),a.value?((0,n.wg)(!0),(0,n.iD)(n.HY,{key:0},(0,n.Ko)(o.value,(([e,t])=>((0,n.wg)(),(0,n.iD)("div",{key:e,class:(0,c.C_)(i.value?"trwavelet trwavelet_eternal":"wavelet wavelet_eternal"),style:(0,c.j5)("left:"+t.x+"px; top:"+t.y+"px;")},[i.value?((0,n.wg)(),(0,n.iD)("div",x,j)):(0,n.kq)("",!0)],6)))),128)):(0,n.kq)("",!0),(0,n._)("div",M,[(0,n._)("div",{class:"ui-container-toggle",style:(0,c.j5)(0==o.value.size?"display: block !important;":"")},[(0,n._)("div",{class:(0,c.C_)(["connection-status mb-3",_.value]),style:(0,c.j5)("background-color:"+_.value+"; opacity: "+(g.value?1:.3)+";")},null,6),(0,n._)("div",S,[(0,n._)("label",T,[D,$,(0,n._)("span",{style:(0,c.j5)(0==o.value.size?"color: red":"color: green")},(0,c.zw)(o.value.size)+" ids loaded",5),O]),(0,n._)("input",{class:"form-control form-control-sm",id:"map-file-upload",type:"file",onChange:v},null,32)]),(0,n._)("div",U,[(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=e=>a.value=e),id:"grid-checkbox"},null,512),[[l.e8,a.value]]),q]),(0,n._)("div",E,[(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=e=>f.value=e),id:"sim-checkbox",onChange:b},null,544),[[l.e8,f.value]]),H]),(0,n._)("div",V,[(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=e=>Y.value=e),id:"color-wavelets-checkbox"},null,512),[[l.e8,Y.value]]),P]),L,(0,n._)("div",I,[(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=e=>i.value=e),id:"tr-checkbox"},null,512),[[l.e8,i.value]]),z])],4)])]))}},N=o(89);const R=(0,N.Z)(F,[["__scopeId","data-v-6ddc1625"]]);var Y=R,A={__name:"App",setup(e){return(e,t)=>((0,n.wg)(),(0,n.j4)(Y))}};const K=A;var G=K;o(8937);(0,l.ri)(G).mount("#app")}},t={};function o(l){var n=t[l];if(void 0!==n)return n.exports;var c=t[l]={exports:{}};return e[l](c,c.exports,o),c.exports}o.m=e,function(){var e=[];o.O=function(t,l,n,c){if(!l){var s=1/0;for(u=0;u<e.length;u++){l=e[u][0],n=e[u][1],c=e[u][2];for(var a=!0,i=0;i<l.length;i++)(!1&c||s>=c)&&Object.keys(o.O).every((function(e){return o.O[e](l[i])}))?l.splice(i--,1):(a=!1,c<s&&(s=c));if(a){e.splice(u--,1);var r=n();void 0!==r&&(t=r)}}return t}c=c||0;for(var u=e.length;u>0&&e[u-1][2]>c;u--)e[u]=e[u-1];e[u]=[l,n,c]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var l in t)o.o(t,l)&&!o.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,l){var n,c,s=l[0],a=l[1],i=l[2],r=0;if(s.some((function(t){return 0!==e[t]}))){for(n in a)o.o(a,n)&&(o.m[n]=a[n]);if(i)var u=i(o)}for(t&&t(l);r<s.length;r++)c=s[r],o.o(e,c)&&e[c]&&e[c][0](),e[c]=0;return o.O(u)},l=self["webpackChunkwavelets"]=self["webpackChunkwavelets"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=o.O(void 0,[998],(function(){return o(2483)}));l=o.O(l)})();
//# sourceMappingURL=app.ad16efca.js.map